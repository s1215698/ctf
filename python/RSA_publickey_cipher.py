#coding=utf-8
#以下情形可考慮使用
#########1.提供一個密文和公鑰檔案
#2.透過openssl rsa -pubin -in [公鑰檔] -text -mudulus -noout 查得 n 和加密參數e
#3.n先轉成10進位 去http://factordb.com/ 利用n取p q值
#4.去算私鑰



from struct import pack
import gmpy2
import libnum
from Crypto.Util.number import *
import rsa




n=679579929445417090796373314958352880510177361729462192689791243102196769018146341419940569102496651824937299738537456135576544432049079391002898300198797221924437483724643855477018147774288639336155228900597734744173869318844255692475545835684556709775073336109109846752772077385437851448215328141096660261438308826704924125013674189002595250203294762596028965332899775208773320006393676223592135995088535678385027358187339301997688102383636136137538127006868529224901937059267136080402498877432166613191344576652312438714566169382753700465260156143199707252590250373280921870375431796105736552074603804910696325743691317781099016524628381496580097091743568617678702048038069242893159548715952220738591853532842685873312671737282216587819901194012521678998260475885832473622985727883975124471845904737187619272225493895151528492485662812723544801160854702031374139249931074296308823290432595308403828801791587669033874727165870679822406781290964672011384619603806807929535343669910983489305627365878875070183041322048287933334860184706560568705486457653908793101001681477629011548904811634444811222964335392889057546387687009524925124067314606044124474249676421150573417293107359829615152483114883332226126099611964771240840397712466389991199511710336396024899321594551704065517911271983124874364734945974950076370738715130667383887201949468771251327190683519610856620025566675621926314874396030840219278916815000865282846642529711462753894749115541586140580337162009750195223178235180176734250985597156373563381550790868104361886324053097508335099051385614181800664174756482090785602210645518723893919206065164862091614302474277173767210274990238910117421644634219154493542479444330391986088773150664240652037397933338319430212833196600978295172801790024303762943223958292905027627071463633404313069465721168381112461333905393158190230869565483634526574253400121555735123517319351960115057100697984253076563406503138996670196215058454245883679008273985640483229330920592583738721183501876697489989501614020773672392914623155639709219835737212685155663671557075851092437571437899014501489942395016846236551636379971057692229594943250641132787380383941390997030426400545923793467820029807517860639514911381350718072026344114427138700477301899713331704181120773900158527297665949189552554882800273593488113047743490525046122703696950080616239685749707583471176065779395554462380674306857878865027422013727988520108938859999419465483361034025171872484927656994901513948065911490283205309663657333204840476504296444200426929020926139116081523101524090361675265336198228514115895029703639031
e=65537 

p=260687538913047604611581784183499992008451760653785074016920718323190075912750802620741024634382067897986936407072164858
654195035172056629230527593989978466296098220579031027154724041642557344915423242566240332284307941704981938020407661739
104882149483433969072174052675580644164713319546908058746795753762649896919296312912702039493797237183118384499796757914
157936629672274357161577311007769338358918777509136488505959298049498018461823273893799669038335872602861372239911549680
531979970541528181711754520442958622706059603000655429088872469604344301647170492716926975027102329909258120989355802343
558462047316328752521306824960655230501606894696454547299868668551619819367530969111390441903346427083466873717778205853
984905381790237396069409514016317067322105019049986366714245693681256834514176535381210683575566036929609986694319036120
560201862975426434985372574748540556000702736560930190396248279747095930579691977036607335841985416541503515963817848780
705827093841092321324825882821075072622553561916744473353548759606182352622008019859330726239330083782855413787656845382
479896229326659871568516059343215385393836820040891163826148343904385963328442668250413125432533185139042633099387310968
853063208000057718438859818276275817262048678368751842523947169311954597690408896814857060351
q=260687538913047604611581784183499992008451760653785074016920718323190075912750802620741024634382067897986936407072164858
654195035172056629230527593989978466296098220579031027154724041642557344915423242566240332284307941704981938020407661739
104882149483433969072174052675580644164713319546908058746795753762649896919296312912702039493797237183118384499796757914
157936629672274357161577311007769338358918777509136488505959298049498018461823273893799669038335872602861372239911549680
531979970541528181711754520442958622706059603000655429088872469604344301647170492716926975027102329909258120989355802343
558462047316328752521306824960655230501606894696454547299868668551619819367530969111390441903346427083466873717778205853
984905381790237396069409514016317067322105019049986366714245693681256834514176535381210683575566036929609986694319036120
560201862975426434985372574748540556000702736560930190396248279747095930579691977036607335841985416541503515963817848780
705827093841092321324825882821075072622553561916744473353548759606182352622008019859330726239330083782855413787656845382
479896229326659871568516059343215385393836820040891163826148343904385963328442668250413125432533185139042633099387310968
853063208000057718438859818276275817262048678368751842523947169311954597690408896814857060353

d=int(gmpy2.invert(e,(p-1)*(q-1)))


privatekey = rsa.PrivateKey(n , e , d , p , q)
with open("C:\ctf_share\cipher.bin","rb") as f:
    print(rsa.decrypt(f.read(),privatekey).decode())






'''
file = open("C:\\fllllllag.txt","rb")
c = int.from_bytes(file.read(),byteorder='big')
m= long_to_bytes(pow(c,d,n))
print (m)
'''